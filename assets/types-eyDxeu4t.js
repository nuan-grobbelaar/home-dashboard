import{j as I}from"./jsx-runtime-D_zvdyIk.js";import{r as o,e as P}from"./iframe-JmGQLgl2.js";const D=e=>I.jsx("div",{className:"widget-grid__filler","data-selected":e.selected,"data-active":e.active,"data-mobile":e.mobile,onMouseDown:e.active?s=>e.handleMouseDown(e,s):()=>{},onMouseEnter:e.active?s=>e.handleMouseEnter(e,s):()=>{}});D.__docgenInfo={description:"",methods:[],displayName:"Filler",props:{key:{required:!0,tsType:{name:"any"},description:""},row:{required:!0,tsType:{name:"number"},description:""},column:{required:!0,tsType:{name:"number"},description:""},selected:{required:!1,tsType:{name:"boolean"},description:""},active:{required:!0,tsType:{name:"boolean"},description:""},mobile:{required:!1,tsType:{name:"boolean"},description:""},handleMouseDown:{required:!0,tsType:{name:"signature",type:"function",raw:"(filler: FillerProps, e: React.MouseEvent) => void",signature:{arguments:[{type:{name:"FillerProps"},name:"filler"},{type:{name:"ReactMouseEvent",raw:"React.MouseEvent"},name:"e"}],return:{name:"void"}}},description:""},handleMouseEnter:{required:!0,tsType:{name:"signature",type:"function",raw:"(filler: FillerProps, e: React.MouseEvent) => void",signature:{arguments:[{type:{name:"FillerProps"},name:"filler"},{type:{name:"ReactMouseEvent",raw:"React.MouseEvent"},name:"e"}],return:{name:"void"}}},description:""}}};function R(e="CELL_DRAG"){if(e==="NONE")return{selectedFiller:[],placedGridItem:null,setPlacedItemToLoading:()=>{},removePlacedItem:()=>{},handleMouseDown:()=>{},handleMouseEnter:()=>{},handleMouseUp:()=>{},setOccupiedPositions:()=>{}};const[s,l]=o.useState(!1),[c,p]=o.useState([]),[h,f]=o.useState(null),[T,b]=o.useState([]),y=o.useRef(s);o.useEffect(()=>{y.current=s},[s]);const i=o.useRef(c);o.useEffect(()=>{i.current=c},[c]);const E=a=>{f(a)},M=()=>{f(null)},t=()=>{h&&f({...h,isLoading:{isLoading:!0,message:"Saving widget"}})},n=(a,r)=>{y.current||(l(!0),f(null),p([a]),r.preventDefault())},d=a=>{if(!y.current||i.current.length===0)return!1;let r=1/0,v=-1/0,w=1/0,q=-1/0;for(const u of[...i.current,a])u.row<r&&(r=u.row),u.row>v&&(v=u.row),u.column<w&&(w=u.column),u.column>q&&(q=u.column);for(const[u,S]of T)if(u>=r&&u<=v&&S>=w&&S<=q)return!1;return!0};return{selectedFiller:c,placedGridItem:h,setPlacedItemToLoading:t,removePlacedItem:M,handleMouseDown:n,handleMouseEnter:(a,r)=>{if(!d(a))return;const v=i.current.findIndex(w=>w.row===a.row&&w.column===a.column);v>-1?p(i.current.slice(0,v+1)):p([...i.current,a]),r.preventDefault()},handleMouseUp:a=>{y.current&&(l(!1),E({position:{rowStart:Math.min(...i.current.map(r=>r.row)),rowEnd:Math.max(...i.current.map(r=>r.row))+1,colStart:Math.min(...i.current.map(r=>r.column)),colEnd:Math.max(...i.current.map(r=>r.column))+1}}),p([]),a.preventDefault())},setOccupiedPositions:b}}const G=e=>{const{selectedFiller:s,placedGridItem:l,removePlacedItem:c,setPlacedItemToLoading:p,handleMouseUp:h,handleMouseDown:f,handleMouseEnter:T,setOccupiedPositions:b}=R(e.placerMode);o.useEffect(()=>{window.addEventListener("mouseup",t=>h(t))},[]),o.useEffect(()=>{c()},[e.children]);const y=t=>{e.onSaveGridItem?e.onSaveGridItem(t):console.error("onSaveGridItem is udnefined"),p()},i=o.useMemo(()=>{const t=P.Children.toArray(e.children),n=t.filter(d=>d.type===e.ItemComponent).map(d=>P.cloneElement(d,{...d.props,editMode:e.editMode}));return t.length>n.length&&console.error(`${t.length-n.length} child(ren) of Grid aren't GridItems`),l?[...n,o.createElement(e.ItemComponent,{...l,unsaved:!0,removeItem:c,onSave:y,key:"unsaved",setError:e.setError})]:n},[e.children,l]),E=o.useMemo(()=>i.reduce((t,n)=>{const d=[];for(let m=n.props.position.colStart;m<n.props.position.colEnd;m++)for(let g=n.props.position.rowStart;g<n.props.position.rowEnd;g++)d.push([g,m]);return[...t,...d]},[]),[i]);o.useEffect(()=>{b(E)},[E]);const M=[];for(let t=1;t<=e.rows;t++)for(let n=1;n<=e.columns;n++)E.some(([m,g])=>m==n&&g==t)||M.push(I.jsx(D,{row:n,column:t,selected:s&&s.some(m=>m.row===n&&m.column===t),mobile:e.mobile,active:e.editMode??!1,handleMouseDown:f,handleMouseEnter:T},`widget-filler-${n}-${t}`));return I.jsxs("div",{className:"widget-grid",style:{gridTemplateColumns:`repeat(${e.columns}, 1fr)`,gridTemplateRows:`repeat(${e.rows}, 1fr)`,...e.style},children:[i,M]})};G.__docgenInfo={description:"",methods:[],displayName:"Grid",props:{columns:{required:!0,tsType:{name:"number"},description:""},rows:{required:!0,tsType:{name:"number"},description:""},placerMode:{required:!1,tsType:{name:"union",raw:'"NONE" | "CELL_DRAG"',elements:[{name:"literal",value:'"NONE"'},{name:"literal",value:'"CELL_DRAG"'}]},description:""},mobile:{required:!1,tsType:{name:"boolean"},description:""},editMode:{required:!1,tsType:{name:"boolean"},description:""},onSaveGridItem:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: P) => void",signature:{arguments:[{type:{name:"P"},name:"item"}],return:{name:"void"}}},description:""},setError:{required:!1,tsType:{name:"signature",type:"function",raw:"(error: String | null) => void",signature:{arguments:[{type:{name:"union",raw:"String | null",elements:[{name:"String"},{name:"null"}]},name:"error"}],return:{name:"void"}}},description:""},ItemComponent:{required:!0,tsType:{name:"ReactComponentType",raw:"React.ComponentType<P>",elements:[{name:"P"}]},description:""},style:{required:!1,tsType:{name:"CSSProperties"},description:""}},composes:["PropsWithChildren"]};const C=e=>I.jsx("div",{"data-unsaved":e.unsaved,className:"widget-component",style:{gridArea:`${e.position.colStart} / ${e.position.rowStart} / ${e.position.colEnd} / ${e.position.rowEnd}`},children:e.children});C.__docgenInfo={description:"",methods:[],displayName:"WidgetComponent",props:{position:{required:!0,tsType:{name:"GridItemPosition"},description:""},unsaved:{required:!1,tsType:{name:"boolean"},description:""},isLoading:{required:!1,tsType:{name:"LoadingState"},description:""},editMode:{required:!1,tsType:{name:"boolean"},description:""},isMobile:{required:!1,tsType:{name:"boolean"},description:""},onSave:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: any) => void",signature:{arguments:[{type:{name:"any"},name:"item"}],return:{name:"void"}}},description:""},removeItem:{required:!1,tsType:{name:"signature",type:"function",raw:"(id?: string) => void",signature:{arguments:[{type:{name:"string"},name:"id"}],return:{name:"void"}}},description:""},id:{required:!1,tsType:{name:"any"},description:""},type:{required:!1,tsType:{name:"string"},description:""},columns:{required:!1,tsType:{name:"number"},description:""},rows:{required:!1,tsType:{name:"number"},description:""}},composes:["PropsWithChildren"]};function N(e){return e&&typeof e=="object"&&"insert"in e}function A(e,s){return e&&typeof e=="object"&&!Array.isArray(e)&&Object.values(e).every(l=>Array.isArray(l)&&l.every(c=>s(c)))}function F(e){return e&&(!e.value||typeof e.value=="string")}function _(e){return e&&e.value&&typeof e.value=="number"}function j(e){return e&&typeof e.value=="object"&&!Array.isArray(e.value)}export{G,C as W,A as a,j as b,_ as c,F as d,N as i};
